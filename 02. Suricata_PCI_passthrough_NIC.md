# Add Suricata (PCI Passthrough NIC)
---
After guide **01. ELK-Wazuh-Setup.md** it is recommended to get a snapshot if everything working as expected (Debian 13, ELK stack, Wazuh Manager).
---
Poweroff the system and add the second NIC to Hardware in Proxmox settings
---
---

Add --> PCI device
---
Choose Raw device and find your device for dropdown list
---
Add the device and power on the system
---

## Verify PCI passthrough NIC is correct (CRITICAL)

**Run**
```bash
ip addr
```

**You should see:**
eth0 (or similar) → has IP
eth1 (or similar) → NO IP

Verify link state:
```
ip link show eth1
```

Bring it UP if is down (no IP):
```
sudo ip link set eth1 up
```

# Install Suricata
```bash
sudo apt update
sudo apt install -y suricata
```

**Check version - we want Suricata 7.x or later and AF_PACKET support
```
suricata --build-info | head -n 5
```

## Disable before config
```bash
sudo systemctl stop suricata
sudo systemctl disable suricata
```

## Edit suricata.yml
---
**Configure as below**

```yaml
outputs:
  - fast:
      enabled: no

  - eve-log:
      enabled: yes
      filetype: regular
      filename: /var/log/suricata/eve.json

      pcap-file: false

      community-id: true
      community-id-seed: 0

      xff:
        enabled: no

      types:
        - alert:
            tagged-packets: no

        - dns:
          enabled: yes
          version: 2
          # requests: yes  # Enable if too much noise
          # responses: no  # Enable if too much noise
        - tls:
          extended: no
        - ssh
        - dhcp:
          enabled: no
        - mqtt:
          passwords: no

        - stats:
          totals: no
          threads: no
          deltas: no
        - http:
            extended: no

        - flow:
            enabled: yes
            log-flow-start: false

af-packet:
  - interface: <NIC-2-Interface name>
    cluster-id: 99
    cluster-type: cluster_flow
    defrag: yes
    use-mmap: yes
    ring-size: 200000

```

## Get IDS signatures (ET Open) using suricata-update
**Right now you only have the “events” rules. For actual detections, do:**

a) Update sources index
```bash
sudo suricata-update update-sources
```
b) Enable ET Open (free, standard)
```
sudo suricata-update enable-source et/open
```

c) Download and build rules
```
sudo suricata-update
```
**This produces a combined rules file in /var/lib/suricata/rules/ (often suricata.rules).**

## Start Suricata in live mode

```
sudo systemctl enable suricata
sudo systemctl start suricata
```

**Confirm it’s running:**

```
sudo systemctl status suricata --no-pager
```

## Validate configuration file
```
sudo suricata -T -c /etc/suricata/suricata.yaml -i <NIC-2 Interface name>
```


