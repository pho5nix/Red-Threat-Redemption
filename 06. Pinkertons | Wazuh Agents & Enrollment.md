# Wazuh Agent Enrollment CLI - Version 4.14.3
---

## Prerequisites
**Ensure communication and security as enrollment fails due to network blocks or mismatches.**

- Manager Accessibility: Endpoint must reach manager IP/FQDN (e.g., YOUR-DEBIAN-IP) over network. Agent sends registration request to manager on TCP 1514 and reports logs on TCP 1515.
- Endpoint OS: Linux or Windows.Agent software is OS-specific, wrong OS causes install failure.
- Admin Access: Root/sudo on Linux manager/endpoint, Admin on Windows.Istallation edits system files/services, requiring elevated privileges.
- Version Match: Both manager/agent must be 4.14.3. Check manager version: sudo /var/ossec/bin/wazuh-control info.

## Add Agent & Extract Key
### Manager stores agent metadata in /var/ossec/etc/client.keys, key is encrypted hash for mutual authentication**

**Add agent:**
```
sudo /var/ossec/bin /manage_agents -a "TARGET-ENDPOINT-IP" -n "TARGET-ENDPOINT-HOSTNAME"
# Example: sudo /var/ossec/bin /manage_agents -a "10.10.10.10" -n "windows-pc-01"
```
**Check if agent created and the agent ID**
```
sudo /var/ossec/bin/agent_control -l
```
**Extract key:**
```
sudo ./manage_agents -e AGENT-ID
# Example: sudo ./manage_agents -e 001
```
- Output: Full key string (e.g., "MDAwMSBsaW51eC1lbmRwb2ludC0wMSBhbnkgMzllNT...=").Copy exactly, including equals sign/s.

## Optional but recommended -  Create groups for agents and assign them acoordingly.

**Create group**
```
sudo ./agent_groups -a -g "WindowsPC-Prod"
```

**Add agent to group**
```
sudo /var/ossec/bin/agent_groups -a -i 001 -g "WindowsPC-Prod"
```

**Remove agent from previous assigned grou**
```
 sudo  /var/ossec/bin/agent_groups -r -g default -i 001
```
















